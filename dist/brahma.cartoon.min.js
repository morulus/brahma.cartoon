!function(Brahma){Brahma.app("cartoon",{config:{scenario:!1,direction:"down",frameWidth:!1,frameHeight:!1,autoplay:!0,fps:10,screenWidth:!1,screenHeight:!1,controls:!1,cols:!1,rows:!1,loop:!0,debug:!1,onReady:!1},data:{src:"",frameHeight:0,frameWidth:0,HTMLElements:{}},animation:{scenario:[],top:0,left:0,direction:0,index:0,height:0,width:0},initConfig:function(props){this.config=Brahma.copyProps(this.config,props)},run:function(){var imported={scenario:Brahma(this.selector).data("cartoon-scenario")||this.config.scenario,direction:Brahma(this.selector).data("cartoon-direction")||this.config.direction,cols:parseInt(Brahma(this.selector).data("cartoon-cols"))||this.config.cols,rows:parseInt(Brahma(this.selector).data("cartoon-rows"))||this.config.rows,width:Brahma(this.selector).data("cartoon-width")||this.config.width,height:Brahma(this.selector).data("cartoon-height")||this.config.height,src:Brahma(this.selector).data("cartoon-src")||this.config.src,autoplay:function(uv){return null===uv?this.config.autoplay:"true"===uv?!0:!1}.call(this,Brahma(this.selector).data("cartoon-autoplay")),fps:Brahma(this.selector).data("cartoon-fps")||this.config.fps,controls:Brahma(this.selector).data("cartoon-controls")||this.config.controls,loop:Brahma(this.selector).data("cartoon-loop")||this.config.loop,debug:Brahma(this.selector).data("cartoon-debug")||this.config.debug};if(Brahma(this.selector).data("cartoon")&&(imported=Brahma.copyProps(imported,Brahma.parseCssDeclarations(Brahma(this.selector).data("cartoon")))),this.initConfig(imported),this.config.src)this.data.src=this.config.src,Brahma(this.selector).css("background-image","url("+this.data.src+")");else{var style=Brahma(this.selector)[0].currentStyle||window.getComputedStyle(Brahma(this.selector)[0],!1);if(this.data.src=style.backgroundImage.slice(4,-1),""===this.data.src)return!1}this.preloadSprite(function(){this.trigger("ready",[this.testImage]),"function"==typeof this.config.onReady&&this.config.onReady.call(this,this.testImage),this.dataCollection(),Brahma(this.selector).css("width",this.animation.width+"px"),Brahma(this.selector).css("height",this.animation.height+"px"),Brahma(this.selector).css("background-size",100/this.data.frameWidth+"%"),this.createNewScenario("object"==typeof this.config.scenario||this.config.scenario instanceof Array?this.config.scenario:"string"==typeof this.config.scenario?this.convertScenarioFormString(this.config.scenario):!1),this.config.controls&&this.module("visual-controller")})},convertScenarioFormString:function(text){for(var dsc=text.split(","),scenario=[],i=0;i<dsc.length;i++)if(dsc[i].indexOf("..")>=0){for(var sm=dsc[i].split(".."),q=0;q<sm.length-1;q++)isNaN(parseInt(sm[q]))||scenario.push(parseInt(sm[q])),scenario.push("..");isNaN(parseInt(sm[q]))||scenario.push(parseInt(sm[q]))}else scenario.push(dsc[i]);return scenario},dataCollection:function(){if(this.animation.width=this.config.width?parseInt(this.config.width):Brahma(this.selector)[0].clientHeight,this.animation.height=this.config.height?parseInt(this.config.height):Brahma(this.selector)[0].clientHeight,this.config.cols?this.data.cols=this.config.cols:this.config.frameWidth||(this.data.cols=1),this.config.rows?this.data.rows=this.config.rows:this.config.frameHeight||(this.data.rows=1),0===this.animation.width&&(this.animation.width=0!==this.animation.height?this.testImage.width*(this.animation.height*this.data.rows/this.testImage.height)/this.data.cols:this.testImage.width/this.config.cols),0===this.animation.height&&(this.animation.height=this.testImage.height*(this.animation.width*this.data.cols/this.testImage.width)/this.data.rows),this.config.cols)this.data.frameWidth=1/this.config.cols,this.data.cols=this.config.cols;else{var px=this.config.frameWidth?Brahma.percentEq(this.config.frameWidth,this.animation.width):this.animation.width;this.data.cols=Math.floor(this.testImage.width/px),this.data.frameWidth=px/this.testImage.width}if(this.config.rows)this.data.frameHeight=100/this.config.rows,this.data.rows=this.config.rows;else{var px=this.config.frameHeight?Brahma.percentEq(this.config.frameHeight,this.animation.width):this.animation.height;this.data.rows=Math.floor(this.testImage.height/px),this.data.frameHeight=px/this.testImage.height}},rewind:function(){return this.animation.index=0,this},play:function(){return this.module("animator").play(),this},pause:function(){return this.module("animator").pause(),this},togglePlay:function(){return this.module("animator").togglePlay(),this},stop:function(){return this.module("animator").stop(),this},progress:function(){return arguments.length>0?(this.module("animator").goToProgress(arguments[0]),this):this.module("animator").getProgress()},preloadSprite:function(callback){var that=this;this.testImage=new Image,this.testImage.onload=function(){callback.call(that)},this.testImage.onerror=function(){},this.testImage.src=this.data.src},createNewScenario:function(scenario){var framesCount=this.data.cols*this.data.rows;if(scenario)for(var condition,direct,modif=0,from=null,i=0;i<scenario.length||0!==modif;)if(0===modif||1!==modif)isNaN(parseInt(scenario[i]))?".."===scenario[i]&&(modif=1,1===scenario.length&&this.animation.scenario.push(0)):this.animation.scenario.push(scenario[i]),i++;else{var condition,direct,userTarget;if("undefined"==typeof scenario[i-2])"undefined"==typeof scenario[i]?(from=0,to=framesCount-1,direct=1,condition=function(from,to){return to>=from}):(from=framesCount-1,to=scenario[i]+1,direct=-1,condition=function(from,to){return from>=to});else if(userTarget="undefined"!=typeof scenario[i],from=scenario[i-2],to=userTarget?scenario[i]:framesCount-1,to>framesCount-1&&(to=framesCount-1),from<to?(direct=1,condition=function(from,to){return to>=from}):(direct=-1,condition=function(from,to){return from>=to}),userTarget&&(to-=direct),from===to)break;for(from+=direct;condition(from,to);)this.animation.scenario.push(from),from+=direct;modif=0}else{this.animation.scenario=[];for(var i=0;framesCount>i;i++)this.animation.scenario.push(i)}this.animation.index=0,this.module("animator"),this.config.autoplay&&this.module("animator").play()}}),Brahma.app("cartoon").module("animator",function(){"down"===this.master.config.direction&&(this.mover=this.moveDown),"top"===this.master.config.direction&&(this.mover=this.moveTop),"left"===this.master.config.direction&&(this.mover=this.moveLeft),"right"===this.master.config.direction&&(this.mover=this.moveRight)},{interval:0,data:{dummy:!1},mover:null,play:function(){if(this.interval>0)return this.data.dummy=!1,!0;this.data.dummy=!1;var animator=this;animator.changePosition(this.mover.call(animator)),this.interval=setInterval(function(){return animator.data.dummy?!1:(animator.master.animation.index++,animator.master.animation.index>animator.master.animation.scenario.length-1&&(animator.master.trigger("end"),animator.master.config.loop?animator.master.animation.index=0:animator.pause()),void animator.changePosition(animator.mover.call(animator)))},1e3/this.master.config.fps)},togglePlay:function(){this.data.dummy?this.play():this.pause()},pause:function(){this.data.dummy=!0},stop:function(){this.interval>0&&clearInterval(this.interval),this.master.rewind()},goToProgress:function(progress){this.master.animation.index=Math.round(this.master.animation.scenario.length*progress),this.changePosition(this.mover.call(this))},goToFrame:function(frameIndex){this.master.animation.index=frameIndex,this.changePosition(animator.mover.call(this))},getProgress:function(){return this.master.animation.index/this.master.animation.scenario.length},moveTop:function(){var dcol=this.master.animation.scenario[this.master.animation.index]/this.master.data.rows,col=Math.floor(dcol),row=col*this.master.data.rows-this.master.animation.scenario[this.master.animation.index];return[100*-col,100*-row]},moveDown:function(){var dcol=this.master.animation.scenario[this.master.animation.index]/this.master.data.rows,col=Math.floor(dcol),row=this.master.animation.scenario[this.master.animation.index]-col*this.master.data.rows;return[100*-col,100*-row]},moveLeft:function(){var row=(this.master.animation.scenario[this.master.animation.index]/this.master.data.rows,Math.floor(dcol)),col=row*this.master.data.cols-this.master.animation.scenario[this.master.animation.index];return[100*-col,100*-row]},moveRight:function(){var drow=this.master.animation.scenario[this.master.animation.index]/this.master.data.rows,row=Math.floor(drow),col=this.master.animation.scenario[this.master.animation.index]-row*this.master.data.cols;return[100*-col,100*-row]},changePosition:function(shift){Brahma(this.master.selector)[0].style.backgroundPosition=shift[0]+"% "+shift[1]+"%",this.master.trigger("change",[this.master.animation.index,this.master.animation.index/this.master.animation.scenario.length])}}),Brahma.app("cartoon").module("visual-controller",function(){var that=this;this.buildHTML(),this.bindEvents(),this.master.bind("change",function(index,progress){Brahma(that.master.data.HTMLElements.visualReporter).html(index),Brahma(that.master.data.HTMLElements.visualController).css("width",Math.round(100*progress)+"%")})},{bindEvents:function(){var ctrlWidth,that=this,downed=!1;Brahma(this.master.selector).bind("click",function(){that.master.togglePlay()}),this.master.data.HTMLElements.visualControllerWrapper.bind("mousedown",function(e){downed=!0,that.master.pause(),ctrlWidth=this.clientWidth,e.stopPropagation(),Brahma(document).bind("mouseup",function(){downed=!1},!0)}).bind("click",function(e){e.stopPropagation(),that.master.pause(),downed&&that.master.module("animator").goToProgress(e.offsetX/ctrlWidth)}).bind("mousemove",function(e){downed&&that.master.module("animator").goToProgress(e.offsetX/ctrlWidth)})},buildHTML:function(){var that=this,currentPosition=Brahma(this.master.selector).css("position").toLowerCase();("absolute"!==currentPosition||"fixed"!==currentPosition)&&Brahma(this.master.selector).css("position","relative"),this.master.data.HTMLElements.visualController=Brahma(this.master.selector).put("div",{}).css({position:"absolute",bottom:0,left:0,width:"100%",height:"30px",overflow:"hidden",backgroundColor:"rgba(0,0,0,0.2)",cursor:"default"}).tie(function(){that.master.data.HTMLElements.visualControllerWrapper=this}).put("div",{}).css({height:"100%",backgroundColor:"rgba(182, 211, 35, 0.57)","float":"left"}),this.master.data.HTMLElements.visualReporter=Brahma(this.master.selector).put("div",{}).css({position:"absolute",top:0,left:0,bottom:0,right:0,margin:"auto",width:"50%","font-size":"27px",color:"rba(255,0,0,0.35)","text-align":"center",height:"30px",overflow:"hidden"})}})}(Brahma);
//# sourceMappingURL=brahma.cartoon.min.js.map